#include <iostream>
#include <string>
#include <cassert>
#include "../WSProtocol.h"
#include "RFC_6455.h"

using namespace std;

int main ( ) { 
	WSProtocol * protocolTest = new RFC_6455();
	WSAttributes attributes;
	string exampleInput = "GET /chat HTTP/1.1\r\nHost: server.example.com\r\nUpgrade: websocket\r\nConnection: Upgrade\r\nSec-WebSocket-Key: dGhlIHNhbXBsZSBub25jZQ==\r\nOrigin: http://example.com\r\nSec-WebSocket-Protocol: chat, superchat\r\nSec-WebSocket-Version: 13";
	string exampleResponse = "HTTP/1.1 101 Switching Protocols\r\nUpgrade: websocket\r\nConnection: Upgrade\r\nSec-WebSocket-Accept: s3pPLMBiTxaQ9kYGzzhZRbK+xOo=\r\n\r\n";

	int verCheck = protocolTest->handshake( exampleInput , &attributes );
	
	assert ( verCheck == 0 );
	cout<<"Version Check Passed..."<<endl;
	assert ( attributes.channel.compare("chat") == 0 );
	cout<<"Channel Check Passed..."<<endl;
	assert ( exampleResponse.compare(attributes.response) == 0 );
	cout<<"Handshake Passed..."<<endl;
	/*
	
   	A single-frame unmasked text message

         0x81 0x05 0x48 0x65 0x6c 0x6c 0x6f (contains "Hello")v

        A single-frame masked text message

         0x81 0x85 0x37 0xfa 0x21 0x3d 0x7f 0x9f 0x4d 0x51 0x58
         (contains "Hello")

        A fragmented unmasked text message

         0x01 0x03 0x48 0x65 0x6c (contains "Hel")v

         0x80 0x02 0x6c 0x6f (contains "lo")
	
	*/
	string exampleWSMessage_small = "\x81\x05\x48\x65\x6c\x6c\x6f";
	string exampleWSMessage_split = "\x81\x05\x48\x65\x6c\x6c\x6f\x80\x05\x48\x65\x6c\x6c\x6f";
	string exampleWSMessage_long = std::string("\x81\xfE\x05\x0f\x8f\x4e\xce\xd7\xeb\x2f\xba\xb6\xb5\x27\xa3\xb6\xe8\x2b\xe1\xa0\xea\x2c\xbe\xec\xed\x2f\xbd\xb2\xb9\x7a\xe2\x82\xe4\x22\x89\x85\xfd\x07\x8a\x96\xce\x0c\x96\x85\xda\x04\x9f\x81\xe3\x0f\xfa\x9e\xc4\x17\x8a\x96\xce\x0a\xb9\x9b\xf8\x0d\xaa\x96\xdc\x21\xbd\x96\xd5\x17\x8f\x87\xe2\x7e\xfe\xbc\xbf\x2b\xa3\x9d\xc4\x05\xa6\xa6\xc1\x24\xbe\xb0\xc2\x0f\x80\xbe\xd8\x2a\xbb\xe5\xdb\x3e\xf9\x9c\xb7\x3e\x98\xe5\xe1\x21\xb7\xae\xca\x34\x86\xe1\xe1\x0a\xfd\xef\xe6\x1d\x8f\xb3\xee\x02\xf7\xb8\xc2\x2d\x8b\xad\xc7\x0c\xf6\x9c\xb6\x1f\x8f\xb9\xb8\x3b\xbd\x9a\xdb\x0a\xaa\x82\xea\x0b\xf8\x92\xfa\x29\x97\x84\xe2\x7e\xb9\x93\xdd\x02\x87\x82\xbc\x36\x82\xb5\xea\x36\x82\x9b\xd5\x2d\xab\xb6\xf9\x25\x9a\xa2\xde\x2d\xa2\xa5\xeb\x34\x89\xbe\xe4\x7e\x9d\x99\xe7\x06\x80\x9f\xb7\x7d\xac\xa5\xc7\x18\xfd\x9e\xc1\x2a\xfe\xef\xc8\x28\x86\x8f\xd9\x26\xa6\x8f\xa4\x0a\xfa\xe0\xe6\x38\xbd\x84\xfc\x7e\xa7\x90\xf7\x76\x89\xe7\xdf\x37\xf8\xb0\xce\x38\x88\x94\xdc\x7a\xa9\xa0\xa0\x18\xff\x95\xc7\x17\xad\xee\xd7\x25\xac\x8f\xe3\x2b\xab\x95\xf7\x2b\x82\x98\xc6\x2b\xf8\xaf\xe0\x22\x8a\xa3\xf9\x7a\xba\x98\xfc\x0f\x97\x81\xc2\x3d\x8a\xa6\xf8\x1e\x89\xe3\xff\x29\xfd\x87\xd7\x77\xbd\x98\xe5\x14\x9d\x9a\xff\x78\xb6\xe7\xfe\x07\x8f\xae\xf6\x1f\xf9\xbb\xe9\x3f\x88\xe1\xd9\x2a\xbc\xbe\xdf\x1a\xa2\xe0\xda\x38\x86\xe4\xe3\x28\xe1\xb8\xe3\x7a\xfe\xa0\xcc\x20\xa0\x80\xf9\x3c\x98\xe0\xa0\x22\xbd\x9b\xd8\x2b\xff\x81\xe3\x3f\x97\xb5\xc8\x25\x81\x8f\xb6\x01\x8c\x9e\xe1\x7d\xfb\xe3\xfa\x08\x94\xa7\xe2\x1f\x9a\x87\xe0\x21\x83\x8f\xdd\x08\x94\x87\xfa\x37\xa4\xbf\xe2\x3f\x9b\xae\xdc\x2c\x9d\xb0\xca\x1c\xa3\xf8\xfe\x1a\x9d\xa1\xc2\x18\x98\xb1\xc8\x7a\xbb\xb1\xd8\x2b\x9b\xbe\xf7\x22\xe1\x9b\xfc\x16\x8b\xf8\xee\x14\xac\x92\xb6\x1e\x8d\x9d\xd7\x2b\xaf\xaf\xc6\x0b\x98\x8f\xfa\x17\x8c\x94\xdd\x2d\x89\xe5\xc1\x7b\xe1\x9b\xe4\x7c\x87\xe7\xb9\x07\xb9\xa7\xeb\x7a\x94\x85\xcb\x3e\xa3\x86\xdd\x0d\xa5\x98\xf7\x20\xf7\x85\xce\x3c\xb6\x9f\xc7\x7e\xf8\xb9\xff\x0f\xac\x9d\xd8\x77\xf7\x8f\xd8\x08\xbc\xe2\xf5\x17\x9b\xba\xed\x1e\x9b\x9c\xf8\x65\x85\x8e\xdc\x3d\xb6\x93\xbe\x1a\x8f\x9e\xe3\x7a\xb4\xe4\xbb\x1e\xb6\x91\xea\x08\xa6\xae\xe4\x38\xa8\xa4\xc6\x65\xa7\xe4\xc0\x0b\x8a\xf8\xa4\x2c\x80\xb1\xa0\x1f\x85\xae\xe9\x7a\xa1\xe0\xed\x3d\x9f\x91\xe3\x28\xa2\x87\xfd\x26\xbc\xa0\xe8\x0c\xbb\xe0\xfa\x77\xfc\xb9\xbb\x00\x99\xbe\xfa\x34\xf9\xb8\xc9\x18\xbe\x9e\xce\x0a\xe5\xae\xe4\x1f\xa5\xfc\xe1\x23\xab\xe3\xb8\x18\xf9\x82\xb7\x2c\xbf\xee\xf7\x08\x8d\xfc\xcb\x26\xf8\xe4\xec\x79\x85\xa1\xdb\x37\xbb\xe0\xfd\x25\xbb\xa1\xc2\x01\x98\x9e\xd9\x65\x84\xe2\xb6\x22\xbd\xef\xe0\x00\xb8\x82\xcd\x2a\x8c\xba\xcb\x38\xe5\x9a\xe4\x76\xa7\x9a\xb6\x17\x96\xe0\xbc\x3b\xa6\xbb\xe5\x2b\x8b\x87\xda\x65\xb8\x84\xd8\x0f\xfb\xbf\xb9\x04\xb8\xa6\xc7\x2c\x85\xee\xb6\x1a\x9d\xa5\xc8\x1a\x9a\x9c\xfd\x3d\x88\xbd\xe3\x7e\xa5\xb3\xc5\x25\xbd\xb8\xcc\x7f\x89\xad\xe2\x78\x9a\xba\xfc\x7d\x98\xb5\xbb\x27\xb4\xa6\xc9\x2d\xe1\xe7\xcc\x1e\x9e\xe4\xff\x1c\x8f\x9b\xd5\x36\x84\xb0\xdb\x1b\xba\xa0\xed\x36\xaa\x81\xd5\x1a\x97\xe6\xee\x20\xbb\x81\xcd\x03\x99\xb4\xfe\x0b\xa8\x95\xc5\x3c\xa2\xe0\xde\x23\xa5\x95\xeb\x39\xf6\x86\xfb\x37\xfa\x8e\xd9\x07\xaf\xa3\xec\x76\xa4\xb9\xb8\x1d\xa0\x91\xba\x3d\x99\xbc\xc5\x7b\x8b\xbc\xe1\x0c\x98\xbe\xe3\x0b\x83\xe5\xb6\x79\xb8\xae\xe5\x22\x8b\xb6\xcd\x38\x85\xa0\xf7\x79\x8a\xe2\xb7\x3d\x83\x9f\xc5\x20\xba\xb6\xcd\x77\xab\x90\xc4\x7b\xf9\xa1\xe0\x3e\x9a\x95\xf8\x19\xbd\xa0\xbf\x16\x82\x9b\xeb\x06\xbd\x95\xe3\x3d\xba\xf8\xf9\x7d\xaf\x84\xdb\x7f\x80\xbf\xec\x1a\x8b\xa7\xc4\x0a\xff\x99\xf5\x2b\x8b\x98\xec\x78\xb6\x9a\xed\x01\x8f\x8d\xf9\x36\xf9\xa1\xc7\x2d\x9c\x8e\xfc\x07\x83\x96\xfa\x2a\xa5\x8f\xc5\x3a\x9d\x83\xd5\x37\xaa\x86\xf7\x36\x84\x9d\xe9\x0f\xa5\xa7\xb7\x0a\xab\xe4\xbb\x28\x86\xe2\xdc\x7c\xba\xad\xea\x02\xb7\xb4\xb9\x0f\xbd\xb3\xc5\x0f\x80\xe0\xe6\x37\xbb\xa2\xfa\x25\xbf\x9d\xe8\x3c\xb9\x9c\xf7\x7b\x88\xe2\xbd\x38\xa3\x93\xfe\x26\xb6\x93\xf7\x14\xac\xa2\xc7\x09\xfa\x86\xfd\x7e\x8d\xaf\xfc\x37\xb6\xf8\xdd\x7a\x97\xe6\xdf\x76\xf8\x9f\xf7\x3b\x9f\xa6\xe4\x38\x8f\x86\xee\x22\xaf\xb1\xc8\x36\xbf\x8d\xfd\x36\xa6\x9d\xbc\x38\xac\x90\xe2\x23\xbe\xe3\xdf\x16\xbf\xba\xcd\x18\x98\x95\xd6\x2a\xab\x9d\xbf\x18\xb4\xba\xfc\x3a\x97\xb4\xc4\x1e\xfd\x85\xc0\x7d\xaa\xa7\xfe\x2b\xf7\xe3\xd6\x2a\x9f\xbc\xfe\x39\xa4\xa2\xdc\x16\x88\xb9\xeb\x26\x9c\xbd\xd6\x7c\xab\xa1\xda\x04\xad\xa7\xe9\x17\xa0\xfc\xf6\x3e\xb6\xfc\xea\x22\x9d\x81\xda\x3a\x9d\xbc\xe3\x1d\x8d\x91\xdd\x23\x84\x83\xba\x05\xb8\xb3\xfa\x05\xa0\xe2\xda\x7d\x9c\xae\xc7\x78\x81\xb1\xe5\x7e\xf9\xbc\xfd\x2d\x9d\xe4\xfc\x7c\xa0\x9c\xa0\x1d\x87\xa6\xfe\x00\xa5\xb2\xee\x2f\xa8\xfc\xfe\x18\x9e\x85\xa0\x2b\xe5\xbe\xeb\x28\xa5\x81\xe8\x0f\xe5\x90\xbf\x22\x81\xae\xc8\x0a\x96\xa6\xfe\x3e\xaf\xa3\xdb\x76\xf7\xef\xce\x0d\xe1\xb3\xd9\x0d\xa3\xa6\xfd\x05\xb7\x9a\xee\x24\xb9\xae\xd7\x01\xe1\xa0\xdc\x09\xb6\xb5\xd7\x78\xba\xbf\xbf\x0d\xa6\xe0\xd6\x0c\xa8\x84\xb7\x21\x84\x93\xe4\x7e\x87\xa2\xcd\x39\xfa\xb2\xec\x3a\xb9\xaf\xc2\x2b\xa0\x99\xca\x65\xbf\x9e\xde\x14\x8c\xa1\xe1\x17\x9e\xe3\xeb\x06\xfa\xaf\xbf\x7d\xf8\xa2\xee\x01\x8a\xe6\xde\x22\xaa\xad\xb6\x77\x94\x9f\xde\x2d\xfa\x8f\xc5\x27\x9b\xb8\xe5\x3e\xa4\xe6\xba\x24\xad\xba\xfa\x61\x9d\xa3\xe4\x14\xa1\xa6\xb6\x79\x81\x90\xdc\x7b\x8f\xad\xbd\x7c\xff\xa3\xb9\x61\xac\x93\xc7\x20\xa6\xb3\xf9\x03\xa9\xb2\xed\x22\xfe\x9b\xe8\x0f\x8f", 1303);
	string exampleWSMessage_long_payload = "data:image/webp;base64,UklGRrIDAABXRUJQVlA4IKYDAADwLwCdASosAZYAPm00k0emJKKhqNjpgMANiWdu2Tp7K8pV2noyyEzH6nD38iSAdaL9oMcEzHB8K9QAn7usMTDdUeE6EugYSm0wDRLIU3xLbexLLZceavkTuQclrdzGik0SNhHNH83brHV3INd08GfHXVhhX+D47ivsSs0iGx8G0Py6gAvFCS4gw/V1BHYc9XkbXleeBxeLOIe6xolDtv4tOsAYVMsDqwPG4pg3PX9sOjZSMp6x0qIAyyQ7lfqF6VdriPTl7UvH3lf/ol40wCnnWvrV7/lsLWe1VlqYbGkOX9OBIn354uFZpmQTPooMXRFZPuyjhmqUySbSgERm/qTSvMVVfG4ufWeUixl/LsXE/aZbE9PCJXeaxIEVXuYBCRcG2N5/Lk2I06Iwpd4ZRDpmQRCkOxn9RArxHH06npAbJW99XWFr5zYUmbPUKw+KYSsxD1TAIl4z34PxFeFhykvfsI+i3OED/+bNf/QKyf4o7bsQFlflPrhrwgBu7u92n4NWiuz7oFVpIAD+ykQk+nme47V7U8bq9xFC+Dh63c7KvTyu7rkuvMOVIV+J59ls8oNvUBdBmDv+Mk8iM9YX73uhljeEPU+vSWA5h6JvqHbK99TSrGTTKrsFjl0kdJksoC1Gzm6Tms3Vb4izqFc/0CPP3pRALZxJgTUtwbxdVZTY1anuVBMWcqEfBJrl7QmkBdw8Qty4YVIatc8jn7SnF5sWkJ5EknBVilEM297vyjlEaBvKwx7D58sMHJntaB9eGK57vopTBwWsw0XLLdHsBlst/v3aST1NhcTEpKD1NzeEOc6xMbOAZvx7vHcRYsIMAudkXJtSTZydQxxJJfAkp8De34fH5S2tzeLyc6AsdJAN7iyuuukqJgrwKx5F52vmDqhxDxZbuHG4Qr0Cxsyx/R4Y1P86HxuQqkvAQalafGxqZrxhJ3vbGmmp4PXqmBVVBYdeJ0VzmstYcKP3RO3dpqe94YdQkqwjuSXFndhRjY2evUJcpfYn+ypx+elSVUtSklSCFRmJT5KvduKn5U3RyH6Ofj07krcS3s2nK/SIqqNkeaaf+qVPR/e+idfkVgA+G0lOyGDXqqpatT898AC/dVCmqrKyMajwyXO/wSGxbX6th0Ch7YBfS8oJDk0IuBw4ectwxMenNE+qIQZBvnYP4dH4x036uaOD1Qldz99ZHQc4XJiUojpj15jcmu/StkZoq97OGS5Az221t6/bDHnhdvMgebl0LgAA";
	string decodedPayload;
	

	decodedPayload = protocolTest->decode ( exampleWSMessage_long );
	assert ( returnedPayload.compare(exampleWSMessage_long_payload) == 0 );
	
	//assert ( messageLength == 5 );
	//std::cout<<"packetLength check Passed...1"<<std::endl;
    
    //exampleWSMessage_2 = exampleWSMessage_2.substr ( exampleWSMessage.size() - 1, exampleWSMessage_2.size() );
    //messageLength = protocolTest->packetLength ( exampleWSMessage_2 );
    /*
	assert ( messageLength == 3 );
	std::cout<<"packetLength check Passed...2"<<std::endl;

	assert ( examplePayload.compare ( decodedMessage ) == 0 );
	cout<<"(No masked bit) Decode Passed...1"<<endl;
	
	exampleWSMessage = "\x81\x85\x37\xfa\x21\x3d\x7f\x9f\x4d\x51\x58";
	examplePayload = "Hello";
	
	decodedMessage = protocolTest->decode ( exampleWSMessage );
	
	assert ( examplePayload.compare ( decodedMessage ) == 0 );
	cout<<"(Masked bit) Decode Passed...2"<<endl;
	
	exampleWSMessage = "\x81\x05\x48\x65\x6c\x6c";
	examplePayload = "";
	
	decodedMessage = protocolTest->decode ( exampleWSMessage );
	
	assert ( examplePayload.compare ( decodedMessage ) == 0 );
	cout<<"(Partial Packet) Decode Passed...3"<<endl;

	exampleWSMessage = "\x81\x05\x48\x65\x6c\x6c\x6f";
	decodedMessage = "Hello";
	std::string encodedMessage = protocolTest->encode ( decodedMessage );
	
	assert ( encodedMessage.compare ( exampleWSMessage ) == 0 );
	cout<<"(No masked bit) Encode Passed...1"<<endl;
	*/
	
	return 0;
}
